要使用這些函數
EFI_PCI_IO_PROTOCOL.Io.Read()  
EFI_PCI_IO_PROTOCOL.Io.Write()

Summary
Enable a PCI driver to access PCI controller registers in the PCI I/O space. 
Prototype
typedef
EFI_STATUS
(EFIAPI *EFI_PCI_IO_PROTOCOL_MEM) (
IN  EFI_PCI_IO_PROTOCOL               *This,   
IN  EFI_PCI_IO_PROTOCOL_WIDTH  Width,  Width
IN   UINT8                             BarIndex
IN   UINT64                            Offset
IN   UINTN                             Count,
IN OUT VOID                            *Buffer
);

Parameters

This: A pointer to the EFI_PCI_IO_PROTOCOL instance. Type 
EFI_PCI_IO_PROTOCOL is defined in Section 14.4

Width: Signifies the width of the memory operations. Type 
EFI_PCI_IO_PROTOCOL_WIDTH is defined in Section 14.4

BarIndex: The BAR index in the standard PCI Configuration header to use as the 
base address for the I/O operation to perform. This allows all drivers to use BAR relative addressing. The legal range for this field is 0..5.However, the value EFI_PCI_IO_PASS_THROUGH_BAR can be used to bypass the BAR relative addressing and pass Offset to the PCI Root Bridge I/O Protocol unchanged. Type EFI_PCI_IO_PASS_THROUGH_BAR is defined in Section 14.4

Offset: The offset within the selected BAR to start the I/O operation. 

Count: The number of I/O operations to perform. Bytes moved is Width size 
* Count, starting at Offset.

Buffer:For read operations, the destination buffer to store the results. For 
write operations, the source buffer to write data from

Description

The Io.Read(), and Io.Write() functions enable a driver to access PCI controller registers in PCI I/O 
space. 
The I/O operations are carried out exactly as requested. The caller is responsible for any alignment and I/
O width issues which the bus, device, platform, or type of I/O might require. For example on some 
platforms, width requests of EfiPciIoWidthUint64 do not work.
If Width is EfiPciIoWidthUint8, EfiPciIoWidthUint16, EfiPciIoWidthUint32, or 
EfiPciIoWidthUint64, then both Address and Buffer are incremented for each of the Count 
operations performed. 
If Width is EfiPciIoWidthFifoUint8, EfiPciIoWidthFifoUint16, 
EfiPciIoWidthFifoUint32, or EfiPciIoWidthFifoUint64, then only Buffer is incremented for 
each of the Count operations performed. The read or write operation is performed Count times on the 
same Address.
If Width is EfiPciIoWidthFillUint8, EfiPciIoWidthFillUint16, 
EfiPciIoWidthFillUint32, or EfiPciIoWidthFillUint64, then only Address is incremented 
for each of the Count operations performed. The read or write operation is performed Count times 
from the first element of Buffer.
All the PCI transactions generated by this function are guaranteed to be completed before this function 
returns

Status Codes Returned

EFI_SUCCESS            The data was read from or written to the PCI controller.
EFI_INVALID_PARAMETER  Width is invalid.
EFI_INVALID_PARAMETER  Buffer is NULL.
EFI_UNSUPPORTED        BarIndex not valid for this PCI controller.
EFI_UNSUPPORTED        The address range specified by Offset, Width, and Count is not valid for the PCI BAR specified by BarIndex.
EFI_OUT_OF_RESOURCES    The request could not be completed due to a lack of resources



EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL.Pci.Read() 
EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL.Pci.Write()
Summary
Enables a PCI driver to access PCI controller registers in a PCI root bridge’s configuration space.

Prototype
typedef
EFI_STATUS
(EFIAPI *EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL_IO_MEM) (
 IN  EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL       *This,
 IN  EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL_WIDTH  Width,
 IN  UINT64                                 Address,
 IN  UINTN                                  Count,
 IN OUT VOID                                  *Buffer                      
 );

Parameters

This: A pointer to the EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL. Type 
EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL is defined in Section 14.2

Width: Signifies the width of the memory operations. Type EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL_WIDTH Section  is defined in 14.2

Address: The address within the PCI configuration space for the PCI controller. 
See Table 14-1 for the format of Address.

Count: The number of PCI configuration operations to perform. Bytes 
moved is Width size * Count, starting at Address.

Buffer: For read operations, the destination buffer to store the results. For 
write operations, the source buffer to write data from.

Description

The Pci.Read() and Pci.Write() functions enable a driver to access PCI configuration registers for a 
PCI controller. 
The PCI Configuration operations are carried out exactly as requested. The caller is responsible for any 
alignment and PCI configuration width issues that a PCI Root Bridge on a platform might require. For 
example on some platforms, width requests of EfiPciWidthUint64 do not work.
If Width is EfiPciWidthUint8, EfiPciWidthUint16, EfiPciWidthUint32, or 
EfiPciWidthUint64, then both Address and Buffer are incremented for each of the Count 
operations performed. 
If Width is EfiPciWidthFifoUint8, EfiPciWidthFifoUint16, EfiPciWidthFifoUint32, or 
EfiPciWidthFifoUint64, then only Buffer is incremented for each of the Count operations 
performed. The read or write operation is performed Count times on the same Address. 
If Width is EfiPciWidthFillUint8, EfiPciWidthFillUint16, EfiPciWidthFillUint32, or 
EfiPciWidthFillUint64, then only Address is incremented for each of the Count operations 
performed. The read or write operation is performed Count times from the first element of Buffer.
All the PCI transactions generated by this function are guaranteed to be completed before this function 
returns

Table 14-1 PCI Configuration Address
Mnemonic             Byte Offset     Byte Length  Description
Register             0               1            The register number on the PCI Function.
Function             1               1            The PCI Function number on the PCI Device.
Device               2               1            The PCI Device number on the PCI Bus.
Bus                  3               1            The PCI Bus number.
ExtendedRegister     4               4            The register number on the PCI Function. If this field is zero, then the Register field is used for the register number. If this field is nonzero, then the Register field is ignored, and the ExtendedRegister field is used for the register number.


Status Codes Returned

EFI_SUCCESS              The data was read from or written to the PCI root bridge.
EFI_INVALID_PARAMETER    Width is invalid for this PCI root bridge.
EFI_INVALID_PARAMETER    Buffer is NULL.
EFI_OUT_OF_RESOURCES     The request could not be completed due to a lack of resources



EFI_BOOT_SERVICES.LocateProtocol()

Summary
Returns the first protocol instance that matches the given protocol.

Prototype
typedef
EFI_STATUS
(EFIAPI *EFI_LOCATE_PROTOCOL) (
 IN EFI_GUID     *Protocol,
 IN VOID         *Registration  OPTIONAL,
 OUT VOID        **Interface
 );

Parameters

Protocol: Provides the protocol to search for. 

Registration: Optional registration key returned from EFI_BOOT_SERVICES.RegisterProtocolNotify(). If 
Registration is NULL, then it is ignored.

Interface On return, a pointer to the first interface that matches Protocol and Registration

Description
The LocateProtocol() function finds the first device handle that support Protocol, and returns a 
pointer to the protocol interface from that handle in Interface. If no protocol instances are found, then 
Interface is set to NULL. 
If Interface is NULL, then EFI_INVALID_PARAMETER is returned
If Protocol is NULL, then EFI_INVALID_PARAMETER is returned.
If Registration is NULL, and there are no handles in the handle database that support Protocol, then 
EFI_NOT_FOUND is returned.
If Registration is not NULL, and there are no new handles for Registration, then EFI_NOT_FOUND is 
returned.

Status Codes Returned

EFI_SUCCESS             A protocol instance matching Protocol was found and returned in Interface.
EFI_INVALID_PARAMETER   Interface is NULL/Protocol is NULL.
EFI_NOT_FOUND           No protocol instances were found that match Protocol and Registration.


EFI_SIMPLE_TEXT_INPUT_PROTOCOL.ReadKeyStroke()

Summary
Reads the next keystroke from the input device

Prototype
typedef
EFI_STATUS
(EFIAPI *EFI_INPUT_READ_KEY) (
 IN EFI_SIMPLE_TEXT_INPUT_PROTOCOL  *This,
 OUT EFI_INPUT_KEY                  *Key          
 );

Parameters

This: A pointer to the EFI_SIMPLE_TEXT_INPUT_PROTOCOL instance. Type EFI_SIMPLE_TEXT_INPUT_PROTOCOL is defined in Section 12.3

Key: A pointer to a buffer that is filled in with the keystroke information for the key that was pressed. Type EFI_INPUT_KEY is defined in “Related Definitions” below

Description

The ReadKeyStroke() function reads the next keystroke from the input device. If there is no pending keystroke the function returns EFI_NOT_READY. If there is a pending keystroke, then ScanCode is the EFI scan code defined in Table 12-2 .The UnicodeChar is the actual printable character or is zero if the key does not represent a printable character (control key, function key, etc.). 

Status Codes Returned

EFI_SUCCESS       The keystroke information was returned.
EFI_NOT_READY     There was no keystroke data available.
EFI_DEVICE_ERROR  The keystroke information was not returned due to hardware errors.
EFI_UNSUPPORTED   The device does not support the ability to read keystroke data.


EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL.SetAttribute()

Summary
Sets the background and foreground colors for the OutputString()and ClearScreen()functions.

Prototype
typedef
EFI_STATUS
(EFIAPI *EFI_TEXT_SET_ATTRIBUTE) (
 IN EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL  *This,
 IN UINTN                             Attribute              
 );

Parameters

This: A pointer to the EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL instance.Type EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL is defined in the “Related Definitions” of Section 12.4

Attribute: The attribute to set. Bits 0..3 are the foreground color, and bits 4..6 are the background color. All other bits are reserved. See “Related Definitions” below. 

Description

The SetAttribute() function sets the background and foreground colors for the OutputString() and ClearScreen() functions.

The color mask can be set even when the device is in an invalid text mode.

Devices supporting a different number of text colors are required to emulate the above colors to the best of the device’s capabilities.

Status Codes Returned
EFI_SUCCESS       The requested attributes were set.
EFI_DEVICE_ERROR  The device had an error and could not complete the request


EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL.SetCursorPosition()

Summary
Sets the current coordinates of the cursor position.

Prototype
typedef
EFI_STATUS
(EFIAPI *EFI_TEXT_SET_CURSOR_POSITION) (
IN EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL  *This,
IN UINTN                            Column,
IN UINTN                            Row
 );

Parameters

This: A pointer to the EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL instance. Type EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL is defined in the “Related Definitions” of Section 12.4

Column, Row: The position to set the cursor to. Must greater than or equal to zero and less than the number of columns and rows returned by QueryMode()

Description
The SetCursorPosition() function sets the current coordinates of the cursor position. The upper left corner of the screen is defined as coordinate (0, 0). 

Status Codes Returned

EFI_SUCCESS       The operation completed successfully.
EFI_DEVICE_ERROR  The device had an error and could not complete the request.
EFI_UNSUPPORTED   The output device is not in a valid text mode, or the cursor position is 
invalid for the current mode.

EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL.EnableCursor()

Summary
Makes the cursor visible or invisible. 

Prototype
typedef
EFI_STATUS
(EFIAPI *EFI_TEXT_ENABLE_CURSOR) (
 IN EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL  *This,
 IN BOOLEAN                           Visible
 );

Parameters

This: A pointer to the EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL instance. Type EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL is defined in the “Related Definitions” of Section 12.4

Visible: If TRUE, the cursor is set to be visible. If FALSE, the cursor is set to be 
invisible.

Description

The EnableCursor() function makes the cursor visible or invisible.
Status Codes Returned

EFI_SUCCESS       The operation completed successfully.
EFI_DEVICE_ERROR  The device had an error and could not complete the request or the device does not support changing the cursor mode.
EFI_UNSUPPORTED   The output device does not support visibility control of the cursor.


EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL.SetMode()

Summary
Sets the output device(s) to a specified mode.

Prototype
typedef
EFI_STATUS
(* EFIAPI EFI_TEXT_SET_MODE) (
 IN EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL  *This,
 IN UINTN                            ModeNumber
 );

Parameters

This: A pointer to the EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL instance. Type EFI_SIMPLE_TEXT_OUTPUT_PROTOCOL is defined in the “Related Definitions” of Section 12.4


ModeNumber: The text mode to set.

Description

The SetMode() function sets the output device(s) to the requested mode. On success the device is in the geometry for the requested mode, and the device has been cleared to the current background color with the cursor at (0,0)

Status Codes Returned

EFI_SUCCESS       The requested text mode was set.
EFI_DEVICE_ERROR  The device had an error and could not complete the request.
EFI_UNSUPPORTED   The mode number was not valid.

EFI_BOOT_SERVICES.WaitForEvent()

Summary
Stops execution until an event is signaled.

Prototype
typedef
EFI_STATUS
(EFIAPI *EFI_WAIT_FOR_EVENT) (
IN UINTN       NumberOfEvents,
IN EFI_EVENT   *Event,
OUT UINTN      *Index
);

Parameters

NumberOfEvents: The number of events in the Event array.
Event: An array of EFI_EVENT. Type EFI_EVENT is defined in the CreateEvent() function description.

Index: Pointer to the index of the event which satisfied the wait condition.

Description

This function must be called at priority level TPL_APPLICATION. If an attempt is made to call it at any other priority level, EFI_UNSUPPORTED is returned.

The list of events in the Event array are evaluated in order from first to last, and this evaluation is repeated until an event is signaled or an error is detected. The following checks are performed on each event in the Event array.

• If an event is of type EVT_NOTIFY_SIGNAL, then EFI_INVALID_PARAMETER is returned and 
Index indicates the event that caused the failure
• If an event is in the signaled state, the signaled state is cleared and EFI_SUCCESS is returned, and Index indicates the event that was signaled.
• If an event is not in the signaled state but does have a notification function, the notification function is queued at the event’s notification task priority level. If the execution of the event’s notification function causes the event to be signaled, then the signaled state is cleared, 
EFI_SUCCESS is returned, and Index indicates the event that was signaled.
To wait for a specified time, a timer event must be included in the Event array. 
To check if an event is signaled without waiting, an already signaled event can be used as the last event in 
the list being checked, or the CheckEvent() interface may be used. 
Status Codes Returned
EFI_SUCCESS
EFI_INVALID_PARAMETER
EFI_INVALID_PARAMETER
The event indicated by Index was signaled. 
NumberOfEvents is 0. 
The event indicated by Index is of type EVT_NOTIFY_SIGNAL.
EFI_UNSUPPORTED
The current TPL is not TPL_APPLICATION
.
